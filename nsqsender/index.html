<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>NSQSender - logagg-utils</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "NSQSender";
    var mkdocs_page_input_path = "nsqsender.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> logagg-utils</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Overview</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../utils/">Utils</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">NSQSender</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#nsqsender">NSQSender</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#setup">Setup</a></li>
        
            <li><a class="toctree-l3" href="#usage">Usage</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">logagg-utils</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>NSQSender</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="nsqsender">NSQSender</h1>
<p>Publishes logs and heartbeats to a given topic in <a href="https://nsq.io/">NSQ</a>. Also keeps a checks if the depth(Max number of msgs) is not exceeded before sending.</p>
<h2 id="setup">Setup</h2>
<h4 id="install-the-nsq-package-at-where-we-need-to-bring-up-the-nsq-server"><a href="http://nsq.io/deployment/installing.html">Install</a> the <code>nsq</code> package, at where we need to bring up the <code>nsq</code> server.</h4>
<ul>
<li>Run the following commands to install <code>nsq</code>:</li>
</ul>
<pre><code>$ sudo apt-get install libsnappy-dev
$ wget https://s3.amazonaws.com/bitly-downloads/nsq/nsq-1.0.0-compat.linux-amd64.go1.8.tar.gz
$ tar zxvf nsq-1.0.0-compat.linux-amd64.go1.8.tar.gz
$ sudo cp nsq-1.0.0-compat.linux-amd64.go1.8/bin/* /usr/local/bin
</code></pre>

<h4 id="bring-up-the-nsq-instances-at-the-required-server-with-following-commands">Bring up the <code>nsq</code> instances at the required server with following commands:</h4>
<ul>
<li><strong>NOTE:</strong> Run each command in a seperate Terminal window</li>
<li>nsqlookupd</li>
</ul>
<pre><code>$ nsqlookupd
</code></pre>

<ul>
<li>nsqd -lookupd-tcp-address <em>&lt;ip-addr or DNS></em>:4160</li>
</ul>
<pre><code>$ nsqd -lookupd-tcp-address localhost:4160
</code></pre>

<ul>
<li>nsqadmin -lookupd-http-address <em>&lt;ip-addr or DNS></em>:4161</li>
</ul>
<pre><code>$ nsqadmin -lookupd-http-address localhost:4161
</code></pre>

<h2 id="usage">Usage</h2>
<h4 id="sending-logs-to-nsq-to-a-topic">Sending logs to NSQ to a topic</h4>
<pre><code>$ python3
&gt;&gt;&gt; from logagg_utils import NSQSender
&gt;&gt;&gt; from logagg_utils.utils import DUMMY
&gt;&gt;&gt;
&gt;&gt;&gt; logs_sender = NSQSender(nsqd_http_address='localhost:4151', nsq_topic='logs', log=DUMMY)
&gt;&gt;&gt;
&gt;&gt;&gt; import time
&gt;&gt;&gt; def prepare_log_list():
...     log_msg = 'This is log number {}, at time {}'
...     logs = list()
...     for i in range(500): logs.append({'log': log_msg.format(i, time.time())})
...     return logs
... 
&gt;&gt;&gt; logs = prepare_log_list()
&gt;&gt;&gt; logs_sender.handle_logs(logs)
</code></pre>

<h4 id="read-logs-from-a-nsq-topic">Read logs from a NSQ topic</h4>
<pre><code>$ nsq_tail -nsqd-tcp-address localhost:4150 -topic logs
...
...
This is log number 494, at time 1543906852.718413
This is log number 495, at time 1543906852.7184162
This is log number 496, at time 1543906852.7184188
This is log number 497, at time 1543906852.7184217
This is log number 498, at time 1543906852.7184246
This is log number 499, at time 1543906852.7184308
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../utils/" class="btn btn-neutral" title="Utils"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../utils/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
